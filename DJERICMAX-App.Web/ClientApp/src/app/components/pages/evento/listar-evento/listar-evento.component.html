<div class="contaiTable">
  <div *ngIf="!eventos || eventos.length === 0">
    <app-loader></app-loader>
  </div>

  <div *ngIf="eventos && eventos.length > 0">
    <!-- Container da tabela -->
    <div class="table-responsive glass-containerTable">
      <table class="table table-hover table-scroll">
        <thead>
          <tr style="font-size: 11px;">
            <th style="width: 16%; text-align: center">Evento</th>
            <th style="width: 6%; text-align: center">Data</th>
            <th style="width: 4%; text-align: center">Conv.</th>
            <th style="width: 10%; text-align: center">Horário</th>
            <th style="width: 15%; text-align: center">Endereço</th>
            <th style="width: 10%; text-align: center">Cliente</th>
            <th style="width: 5%; text-align: center">Parcelado?</th>
            <th style="width: 5%; text-align: center">Proposta?</th>
            <th style="width: 5%; text-align: center">Contrato?</th>
            <th style="width: 5%; text-align: center">Realizado?</th>
            <th style="width: 15%; text-align: center" colspan="4">
              <!-- Adicionar Evento -->
              <a class="btn add" title="Adicionar Evento de novo Cliente"
                (click)="abrirModal(c, 'addEvento', 'evento')">
                <svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" viewBox="0 0 32 32"><g fill="none"><path fill="url(#SVGFnVq5bNm)" d="M30 16c0 7.732-6.268 14-14 14S2 23.732 2 16S8.268 2 16 2s14 6.268 14 14"/><path fill="url(#SVGGVQr2NRQ)" d="M15 10a1 1 0 1 1 2 0v5h5a1 1 0 1 1 0 2h-5v5a1 1 0 1 1-2 0v-5h-5a1 1 0 1 1 0-2h5z"/><defs><linearGradient id="SVGFnVq5bNm" x1="3" x2="22.323" y1="7.25" y2="27.326" gradientUnits="userSpaceOnUse"><stop stop-color="#52d17c"/><stop offset="1" stop-color="#22918b"/></linearGradient><linearGradient id="SVGGVQr2NRQ" x1="11.625" x2="15.921" y1="10.428" y2="25.592" gradientUnits="userSpaceOnUse"><stop stop-color="#fff"/><stop offset="1" stop-color="#e3ffd9"/></linearGradient></defs></g></svg>
              </a>
            </th>
          </tr>
        </thead>

        <tbody>
          <ng-container *ngFor="let e of eventos; let i = index">
            <tr style="font-size: 11px !important;">
              <td style="text-align: center">{{e.nomeEvento}}</td>
              <td style="text-align: center">{{e.dataEvento | date:'dd/MM/yyyy'}}</td>
              <td style="text-align: center">{{e.convidados}}</td>
              <td style="text-align: center">
                {{e.horaInicio | date:'HH:mm'}} às
                {{e.horaFinal | date:'HH:mm'}}</td>
              <td style="text-align: center">
                <a (click)="mostrarEndereco(e)" style="cursor: pointer;"
                  title="Clique para ver o endereço do Evento">
                  {{e.cidadeEvento}} <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="m12 15l5-5H7z"/></svg>
                </a>
              </td>
              <td style="text-align: center">
                <a (click)="mostrarCliente(e)" style="cursor: pointer;"
                  title="Clique para ver os dados do cliente">
                  {{e?.cliente?.nome}} <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="m12 15l5-5H7z"/></svg>
                </a>
              </td>
              <td style="text-align: center">
                <a (click)="mostrarFormaPagto(e)" style="cursor: pointer;"
                  title="Clique para ver detalhes do Pagamento">
                <input type="checkbox" [checked]="e.parcelado" (change)="marcar($event, e)" />
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="m12 15l5-5H7z"/></svg>
                </a>
              </td>

              <td style="text-align: center">
                <input (change)="marcar($event, e, 'proposta')" [checked]="e.proposta" type="checkbox"/>
              </td>
              <td style="text-align: center">
                <input (change)="marcar($event, e, 'fechado')" [checked]="e.fechado" type="checkbox" />
              </td>
              <td style="text-align: center">
                <input (change)="marcar($event, e, 'realizado')" [checked]="e.realizado" type="checkbox"/>
              </td>

              <td><!-- Serviços -->
                <a class="btn convert" title="Mostrar Serviços Vinculados"
                  (click)="verServicosVinculados(e)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><g fill="none" stroke="#8704ff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14M7.5 4.27l9 5.15"/><path d="M3.29 7L12 12l8.71-5M12 22V12"/><circle cx="18.5" cy="15.5" r="2.5"/><path d="M20.27 17.27L22 19"/></g></svg>
                </a>
              </td>
              <td><!-- Contratos -->
                <a class="btn convert" title="Mostrar Contratos"
                  (click)="abrirModal(e, 'verContrato', 'contrato', i)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#ff6404" d="M21 8v4h-2V9h-5V4H5v16h6v2H3.993A.993.993 0 0 1 3 21.008V2.992C3 2.455 3.449 2 4.002 2h10.995zm-7.214 7.327c.039-.727.6-1.319 1.324-1.396l.87-.092a.5.5 0 0 0 .279-.124l.651-.585a1.48 1.48 0 0 1 1.923-.05l.682.55c.08.065.18.103.284.109l.874.047c.727.039 1.319.6 1.396 1.324l.092.87a.5.5 0 0 0 .124.279l.585.651c.487.542.508 1.357.05 1.923l-.55.682a.5.5 0 0 0-.109.284l-.047.874a1.48 1.48 0 0 1-1.324 1.396l-.87.092a.5.5 0 0 0-.279.124l-.651.585a1.48 1.48 0 0 1-1.923.05l-.682-.55a.5.5 0 0 0-.284-.109l-.874-.047a1.48 1.48 0 0 1-1.396-1.324l-.092-.87a.5.5 0 0 0-.124-.279l-.585-.651a1.48 1.48 0 0 1-.05-1.923l.55-.682a.5.5 0 0 0 .109-.284zm7.244 1.703l-1.06-1.06l-2.47 2.47l-1.47-1.47l-1.06 1.06l2.53 2.53z"/></svg>
                </a>
              </td>
              <td><!-- Editar Evento -->
                <a class="btn edit" title="Editar Evento"
                  (click)="abrirModal(e, 'editarEvento', 'evento', i)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 25 25"><g fill="none" stroke="blue" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"/></g></svg>
                </a>
              </td>
              <td><!-- Excluir Evento -->
                <a class="btn del" data-toggle="modal" title="Cancelar Evento"
                (click)="abrirModal(e,'cancelarEvento', 'evento', i)" data-target="#modalExcluirEvento">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 512 512"><path fill="#ff00c2" d="M149.3 0h-42.7v64h42.7zm256 0h-42.7v64h42.7zM148.9 426.7h214.3c33 0 52.3-22.2 35.9-49.4L286 190.9c-16.5-27.2-43.4-27.2-59.9 0L113 377.3c-16.5 27.1 2.9 49.4 35.9 49.4m85.8-192h42.7v106.7h-42.7zm0 128h42.7v42.7h-42.7zM426.7 0v85.3h-85.3V0H170.7v85.3H85.3V0H0v512h512V0zm42.6 469.3H42.7V128h426.7v341.3z"/></svg>
                </a>
              </td>
              <td><!-- Excluir Evento -->
                <a class="btn del" data-toggle="modal" title="Excluir Evento"
                (click)="abrirModal(e,'excluirEvento', 'evento', i)" data-target="#modalExcluirEvento">
                  <svg xmlns="http://www.w3.org/2000/svg" width="28" height="20" viewBox="0 0 24 24"><path fill="red" d="M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1zm1 2H6v12h12zm-4.586 6l1.768 1.768l-1.414 1.414L12 15.414l-1.768 1.768l-1.414-1.414L10.586 14l-1.768-1.768l1.414-1.414L12 12.586l1.768-1.768l1.414 1.414zM9 4v2h6V4z"/></svg>
                </a>
              </td>
            </tr>

            <!-- TABELA DE DADOS DO ENDEREÇO -->
            <tr *ngIf="expandEnderecoId === e.id"
            style="background: rgba(255, 79, 1, 0.08);">
              <td colspan="11">
                <table class="subtab">
                  <tr style="font-size: 11px;">
                    <th style="width: 40%; text-align: center">Endereço</th>
                    <th style="width: 5%; text-align: center">Nº</th>
                    <th style="width: 20%; text-align: center">Bairro</th>
                    <th style="width: 20%; text-align: center">Cidade</th>
                    <th style="width: 5%; text-align: center">UF</th>
                    <th style="width: 10%; text-align: center" >CEP</th>
                  </tr>
                  <tr style="font-weight: 500;">
                    <td>{{e.logradouroEvento}}</td>
                    <td>{{e.numLogradouroEvento}}</td>
                    <td>{{e.bairroEvento}}</td>
                    <td>{{e.cidadeEvento}}</td>
                    <td>{{e.ufEvento}}</td>
                    <td>{{e.cepEvento}}</td>
                  </tr>
                </table>
              </td>
            </tr>

            <!-- TABELA DE DADOS DO CLIENTE -->
            <tr *ngIf="expandClienteId === e.id"
            style="background: rgba(255, 79, 1, 0.08);">
            <td colspan="12">
                <table class="subtab">
                  <tr style="font-size: 11px;">
                    <th class="thTable" style="width: 27%; text-align: center;">Nome completo</th>
                    <th class="thTable" style="width: 12%; text-align: center;">CPF</th>
                    <th class="thTable" style="width: 10%; text-align: center;">Fone/WhatsApp</th>
                    <th class="thTable" style="width: 15%; text-align: center;">E-mail</th>
                    <th class="thTable" style="width: 5%; text-align: center;">Cliente?</th>
                    <th class="thTable" style="width: 10%; text-align: center;">Bairro</th>
                    <th class="thTable" style="width: 10%; text-align: center;">Cidade</th>
                    <th class="thTable" style="width: 10%; text-align: center;">UF</th>
                  </tr>
                  <tr>
                    <td>{{e?.cliente?.nome}} {{e?.cliente?.sobreNome}}</td>
                    <td>{{e?.cliente?.cpf}}</td>
                    <td>{{e?.cliente?.telefone}}</td>
                    <td>{{e?.cliente?.email}}</td>
                    <td><input type="checkbox" class="btn sem-clique"
                      [checked]="e?.cliente?.ehCliente === 1"
                       (click)="$event.preventDefault()" />
                    </td>
                    <td>{{e?.cliente?.bairro}}</td>
                    <td>{{e?.cliente?.cidade}}</td>
                    <td>{{e?.cliente?.uf}}</td>
                    <td><!-- Visualizar Cliente -->
                      <a class="btn edit" title="Visualizar Cliente"
                        (click)="abrirModal(e, 'edit', 'evento', i)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 25 25"><g fill="none" stroke="blue" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"/></g></svg>
                      </a>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>

            <!-- TABELA DE DADOS DE PAGAMENTO -->
            <tr *ngIf="expandFormaPagtoId === e.id"
            style="background: rgba(255, 79, 1, 0.08);">
              <td colspan="11">
                <table class="subtab">
                  <tr style="font-size: 11px;">
                    <th style="width: 10%; text-align: center">Pago via</th>
                    <th style="width: 25%; text-align: center">Descrição</th>
                    <th style="width: 10%; text-align: center">Parcelado?</th>
                    <th style="width: 10%; text-align: center">Qtd Parcelas</th>
                    <th style="width: 15%; text-align: center">Valor de entrada</th>
                    <th style="width: 15%; text-align: center" >Valor de Parcela</th>
                    <th style="width: 15%; text-align: center">Total Pago</th>
                  </tr>
                  <tr>
                    <!-- <td>Pago por: {{e.formaPagamento.nome}}</td> -->

                    <td *ngIf="e.formaPagamento.ehBoleto">
                      <input type="checkbox" class="btn sem-clique"
                      [checked]="e.formaPagamento.ehBoleto === true"
                       (click)="$event.preventDefault()" /> Boleto?
                    </td>
                    <td *ngIf="e.formaPagamento.ehCartaoCredito">
                      <input type="checkbox" class="btn sem-clique"
                      [checked]="e.formaPagamento.ehCartaoCredito === true"
                       (click)="$event.preventDefault()" /> Cartão?
                    </td>
                    <td *ngIf="e.formaPagamento.ehDeposito">
                      <input type="checkbox" class="btn sem-clique"
                      [checked]="e.formaPagamento.ehDeposito === true"
                       (click)="$event.preventDefault()" /> Depósito?
                    </td>
                    <td *ngIf="e.formaPagamento.ehPix">
                      <input type="checkbox" class="btn sem-clique"
                      [checked]="e.formaPagamento.ehPix === true"
                      (click)="$event.preventDefault()" /> Pix?
                    </td>
                    <td *ngIf="e.formaPagamento.naoFoiDefinido">
                      <input type="checkbox" class="btn sem-clique"
                      [checked]="e.formaPagamento.naoFoiDefinido === true"
                      (click)="$event.preventDefault()" /> Não Definido?
                    </td>
                    <td>{{e.formaPagamento.descricao}}</td>
                    <td>
                      <input type="checkbox" class="btn sem-clique"
                      [checked]="e.parcelado === true"
                       (click)="$event.preventDefault()" />
                    </td>
                    <td>
                      <a (click)="mostrarParcelas(e)" style="cursor: pointer;"
                        title="Clique para ver detalhes das parcelas">
                        {{e.qtdeParcelas}}
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="m12 15l5-5H7z"/></svg>
                      </a>
                    </td>
                    <td>{{e.parcelas[0].valor |
                      currency:'BRL':'symbol':'1.2-2':'pt-BR'}}</td>
                    <td>{{e.valorParcelas |
                      currency:'BRL':'symbol':'1.2-2':'pt-BR'}}</td>
                    <td>{{e.valorTotal |
                      currency:'BRL':'symbol':'1.2-2':'pt-BR'}}</td>
                  </tr>

                  <!-- TABELA DE DADOS DE PARCELAS -->
                  <tr *ngIf="expandParcelasId === e.id">
                    <td colspan="5">
                      <table class="subtab">
                        <tr style="font-size: 11px;">
                          <th>Nº Parcela</th>
                          <th>Vencimento</th>
                          <th>Valor da Parcela</th>
                          <th>Pago?</th>
                        </tr>
                        <tr *ngFor="let p of e.parcelas; let ip = index">
                          <td>{{p.numero}}</td>
                          <td>{{p.dataVencimento | date:'dd/MM/yyyy'}}</td>
                          <td>{{p.valor | currency:'BRL':'symbol':'1.2-2':'pt-BR'}}</td>
                          <td style="text-align: center">
                            <input type="checkbox" [checked]="p.pago"
                              (change)="marcar($event, e, 'parcelaPaga', ip)" />
                          </td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>

          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</div>


<!-- MODAIS  -->
<app-cadastrar-evento
  *ngIf="modalAberta === 'evento'"
  [tab]="'evento'"
  [info]="info"
  [tipo]="tipo"
  [tela]="'evento'"
  (fecharModal)="fecharModal()">
</app-cadastrar-evento>

<!-- <app-cadastrar-evento
  *ngIf="modalAberta === 'evento'"
  [info]="info"
  [tipo]="tipo"
  (fecharModal)="fecharModal()">
</app-cadastrar-evento> -->

<app-modalExcluir
  *ngIf="modalAberta === 'excluirEvento'"
  [info]="info"
  [msg]="msg"
  (confirmar)="excluirEvento(eventoParaExcluir)"
  (cancelar)="fecharModal()">
</app-modalExcluir>
